<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdhocController.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bootstrap</a> &gt; <a href="index.source.html" class="el_package">io.hamal.backend.web</a> &gt; <span class="el_source">AdhocController.kt</span></div><h1>AdhocController.kt</h1><pre class="source lang-java linenums">package io.hamal.backend.web

import io.hamal.backend.req.InvokeAdhoc
import io.hamal.backend.req.Request
import io.hamal.lib.domain.value.NumberValue
import io.hamal.lib.domain.value.StringValue
import io.hamal.lib.domain.value.to
import io.hamal.lib.domain.vo.Code
import io.hamal.lib.domain.vo.ExecId
import io.hamal.lib.domain.vo.InvocationInputs
import io.hamal.lib.domain.vo.InvocationSecrets
import io.hamal.lib.domain.vo.base.Secret
import io.hamal.lib.domain.vo.base.SecretKey
import io.hamal.lib.domain.vo.base.SecretStore
import io.hamal.lib.domain.vo.base.SecretStoreIdentifier
import io.hamal.lib.sdk.domain.ApiAdhocReq
import io.hamal.lib.sdk.domain.ApiReq
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.http.HttpStatus
import org.springframework.http.ResponseEntity
import org.springframework.web.bind.annotation.PostMapping
import org.springframework.web.bind.annotation.RequestBody
import org.springframework.web.bind.annotation.RestController

<span class="nc" id="L25">@RestController</span>
open class AdhocController
<span class="nc" id="L27">@Autowired constructor(</span>
<span class="nc" id="L28">    val request: Request</span>
) {

    @PostMapping(&quot;/v1/adhoc&quot;)
    fun adhoc(
        @RequestBody script: String
    ): ResponseEntity&lt;ApiReq&gt; {

<span class="nc" id="L36">        val result = request(</span>
<span class="nc" id="L37">            InvokeAdhoc(</span>
<span class="nc" id="L38">                inputs = InvocationInputs(</span>
<span class="nc" id="L39">                    listOf(</span>
<span class="nc" id="L40">                        StringValue(&quot;Hello&quot;) to StringValue(&quot;World&quot;),</span>
<span class="nc" id="L41">                        StringValue(&quot;Number&quot;) to NumberValue(42),</span>
                    )
                ),
<span class="nc" id="L44">                secrets = InvocationSecrets(</span>
<span class="nc" id="L45">                    listOf(</span>
<span class="nc" id="L46">                        Secret(</span>
<span class="nc" id="L47">                            SecretKey(&quot;Key&quot;),</span>
<span class="nc" id="L48">                            SecretStore(&quot;store&quot;),</span>
<span class="nc" id="L49">                            SecretStoreIdentifier(&quot;identifier&quot;)</span>
                        )
                    )
                ),
<span class="nc" id="L53">                code = Code(script)</span>
            )
        )

<span class="nc" id="L57">        return ResponseEntity(</span>
<span class="nc" id="L58">            ApiAdhocReq(</span>
<span class="nc" id="L59">                id = result.id,</span>
<span class="nc" id="L60">                status = result.status,</span>
<span class="nc" id="L61">                execId = ExecId(0)</span>
            ),
<span class="nc" id="L63">            HttpStatus.ACCEPTED</span>
        )
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>